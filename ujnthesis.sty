\ProvidesPackage{ujnthesis}

\RequirePackage[dvipsnames]{xcolor} % 额外的颜色
\RequirePackage{pdfpages, setspace, graphicx, dashrule, booktabs, listings, setspace, amsmath, hyperref, tabularx} % 常用宏包
\usepackage[inkscapelatex=false]{svg} % svg
\hypersetup{ % 超链接
	hidelinks,
	colorlinks=true,
	allcolors=black,
	pdfstartview=Fit,
	breaklinks=true
}

\def\UrlAlphabet{ % Url换行宏
      \do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j
      \do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t
      \do\u\do\v\do\w\do\x\do\y\do\z\do\A\do\B\do\C\do\D
      \do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N
      \do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X
      \do\Y\do\Z}
\def\UrlDigits{\do\1\do\2\do\3\do\4\do\5\do\6\do\7\do\8\do\9\do\0}
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\g@addto@macro{\UrlBreaks}{\UrlAlphabet}
\g@addto@macro{\UrlBreaks}{\UrlDigits}

\RequirePackage{fontspec, xeCJK} % 字体
\setCJKmainfont[Path=fonts/,BoldFont={SimHei.ttf}]{SimSun.ttf} % 衬线
\setCJKsansfont[Path=fonts/,BoldFont={SimHei.ttf}]{SimSun.ttf} % 无衬线
\setmainfont[Path=fonts/,BoldFont={*-Bold.ttf}]{Times-New-Roman.ttf}
\setmonofont[Path=fonts/,BoldFont={*-Bold.ttf}]{Times-New-Roman.ttf}
\newcommand{\heiti}{\textbf}

\lstset{ % 代码框
	columns = fullflexible,
	frame = trbl,
	showstringspaces = false,
	breaklines = true,
	extendedchars = false,
	texcl = true,
	basicstyle = \small\linespread{1},
	tabsize = 4,
	backgroundcolor = \color[RGB]{242,242,242},
	keywordstyle = {\color{blue}\bfseries},
	stringstyle = {\color{Maroon}},
	commentstyle = {\color{OliveGreen}}
}

\RequirePackage[a4paper, top = 2.5cm, bottom = 2.5cm, left = 3cm, right = 2.5cm]{geometry} % 页边距

\RequirePackage[scale = 1, angle = 90, color = black, hshift = -5mm, vshift = 8.8cm]{background} % 装订线配置
\backgroundsetup{contents = {\hdashrule[0cm]{26.85cm}{0pt}{0pt}}}

\newcommand{\setblindingline}{\backgroundsetup{contents={\hdashrule[0cm]{26.85cm}{1pt}{1pt}}}} % 装订线生成
\newcommand{\unsetblindingline}{\backgroundsetup{contents = {}}}

\renewcommand{\thefigure}{\thesection{}.\arabic{figure}} % 图表公式标注
\renewcommand{\thetable}{\thesection{}.\arabic{table}}
\renewcommand{\theequation}{\thesection{}.\arabic{equation}}

\RequirePackage{fancyhdr} % 页眉
\pagestyle{fancy}
\fancyhead{}
\chead{\small{济南大学毕业设计}\fontsize{2pt}{7pt}\selectfont{\\ \quad}}

\renewcommand\headrulewidth{1.6pt} % 页眉页脚线
\renewcommand\footrulewidth{1.6pt}

\newcommand{\setfancylength}{ % 内容和页眉页脚边距
	\setlength{\voffset}{3mm}
	\setlength{\headheight}{7mm}
	\setlength{\headsep}{5mm}
	\setlength{\textheight}{245mm}
	\setlength{\footskip}{5mm}
}

\newcommand{\unsetfancylength}{
	\setlength{\voffset}{0mm}
	\setlength{\headheight}{0mm}
	\setlength{\headsep}{0mm}
	\setlength{\footskip}{0mm}
}

\RequirePackage{titletoc} % 目录格式
\titlecontents{section}
	[1em]
	{\normalsize\vspace{0em}}
	{\contentslabel{1em}}
	{\hspace*{-1em}}
	{~\titlerule*[0.4pc]{.}~\contentspage}
\titlecontents{subsection}
	[4em]
	{\normalsize\vspace{0em}}
	{\contentslabel{2em}}
	{\hspace*{0em}}
	{~\titlerule*[0.4pc]{.}~\contentspage}
\titlecontents{subsubsection}
	[6.5em]
	{\normalsize\vspace{0em}}
	{\contentslabel{2.5em}}
	{\hspace*{0em}}
	{~\titlerule*[0.4pc]{.}~\contentspage}

\renewcommand{\contentsname}{\begin{spacing}{1.2}\small{\quad\\ \quad\\ }\large{目\qquad 录\\}\end{spacing}} % 目录标题

\ctexset{ % 全局章节标题及参考文献标题
	section/aftername = {\enspace},
	subsection/aftername = {\enspace},
	subsubsection/aftername = {\enspace},
	bibname = {参\enspace 考\enspace 文\enspace 献}
}


\fancypagestyle{ujnabstract} % 中文摘要格式
{
	\ctexset{
		section/format = {\large\centering\heiti},
		section/beforeskip = {2em},
		section/afterskip = {21pt}
	}
	\pagenumbering{Roman}
	\fancyfoot[C]{\fontsize{2pt}{7pt}\selectfont{\quad \\ \quad}\small{--\enspace\thepage{}\enspace--}}

	\newcommand\cnkeywords[1]{{\\ \quad\small{\textbf{\\ 关键词：}}} ##1}
}

\fancypagestyle{ujnabstract*} % 英文摘要格式
{
	\ctexset{
		section/format = {\zihao{3}\centering\bfseries},
		section/beforeskip = {1.5em},
		section/afterskip = {21pt}
	}
	\fancyfoot[C]{\fontsize{2pt}{7pt}\selectfont{\quad \\ \quad}\small{--\enspace\thepage{}\enspace--}}

	\newcommand\enkeywords[1]{\quad \\\small{\bfseries{Key words：}} ##1}
}

\fancypagestyle{ujncontent} % 目录格式
{
	\fancyfoot{}
	\ctexset{
		section/nameformat = {\large\heiti\centering}
	}
}

\fancypagestyle{ujnbody} % 正文格式
{
	\ctexset{
		section/format += {
			\clearpage
			\setcounter{table}{0}
			\setcounter{figure}{0}
			\setcounter{equation}{0}
		},
		section/titleformat = {\large\heiti},
		section/numberformat = {\large\bfseries},
		section/beforeskip = 5pt,
		section/afterskip = 2.5em,
		subsection/titleformat = {\zihao{4}\heiti},
		subsection/numberformat = {\zihao{4}\bfseries},
		subsection/beforeskip = 0.5em,
		subsection/afterskip = 0.5em,
		subsubsection/titleformat = {\normalsize\heiti},
		subsubsection/numberformat = {\normalsize\bfseries},
		subsubsection/beforeskip = 0.5em,
		subsubsection/afterskip = 0.5em
	}
	\pagenumbering{arabic}
	\fancyfoot[C]{\small{--\enspace\thepage{}\enspace--}}
}

\fancypagestyle{ujnothers}{} % 留空

\fancypagestyle{ujntranslation} % 外文资料翻译格式
{
	\setcounter{page}{1}
	\chead{\small{济南大学毕业设计外文资料翻译}\fontsize{2pt}{7pt}\selectfont{\\ \quad}}
}

% 各类新环境，主要是应用环境前取消配置目录检索项的能力
\newenvironment{ujnabstract}{\ctexset{section/numbering = false}\section*{\quad\\}}{}
\newenvironment{ujnabstract*}{\ctexset{section/numbering = false}\small{\quad\\}}{}
\newenvironment{ujnbody}{\ctexset{section/numbering = true}}{}
\newenvironment{ujnconclusion}{\ctexset{section/numbering = false}}{}
\newenvironment{ujnreference}{\ctexset{section/numbering = false}}{}
\newenvironment{ujnthanks}{\ctexset{section/numbering = false}}{}
\newenvironment{ujnappendix}{\ctexset{section/numbering = false}}{}

% 外文资料翻译环境
\newenvironment{trans}{}{}
\newenvironment{transabst}{
	\setlength{\parskip}{13pt}
}{}

\newcommand{\transource}[4]{
	\begin{spacing}{1.25}
		\rightline{\zihao{4}{\textbf{#1}, #2, #3: #4.}}
	\end{spacing}
}
\newcommand{\transtitle}[1]{
	\begin{trans}\centering
		\heiti{\normalsize{\quad\\}\Large{#1\\}}
	\end{trans}
}
\newcommand{\transauther}[1]{
	\begin{trans}\centering
		{\large{\quad\\}\normalsize{#1\\}}
	\end{trans}
}

\newcommand{\transinstitution}[1]{
	\begin{trans}\centering
		{\small{#1\\}\tiny{\quad\\}}
	\end{trans}
}

\newcommand{\transabstract}[2]{
	\begin{transabst}\raggedright
		\fontsize{10.5bp}{15pt}\selectfont{\heiti{摘\quad 要\quad }{#1\\}
		{\heiti{关键词\quad }{#2\\}}}
	\end{transabst}
	{\fontsize{2bp}{0pt}\selectfont{\quad\\}}
}

\newcommand{\transbody}{
	\setcounter{section}{0}
	\renewcommand{\section}{\@startsection{section}{1}{0bp}{15pt}{15pt}{\zihao{4}\heiti}}
	\renewcommand{\subsection}{\@startsection{subsection}{2}{0bp}{15pt}{15pt}{\normalsize\heiti}}
	\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0bp}{6pt}{6pt}{\normalsize\heiti}}

	\ctexset{
		section/aftername = {\quad},
		subsection/aftername = {\quad},
		subsubsection/aftername = {\quad}
	}
}
